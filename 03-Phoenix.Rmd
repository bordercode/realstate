# Feeling the heat: The California-Arizona route, in search for affordable housing.

```{r, include=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)

```


In this chapter, our focus is to examine regional migration patterns originating from California. We specifically investigate the movement of people toward new destinations, with a notable emphasis on Arizona State and the Phoenix Metropolitan area, in the Southwest region.  The main goal is to highlight  these internal migration patterns in the context of underlying housing pricing conditions. This analysis adds to existing knowledge by providing a detailed understanding of the relationship between regional migration and the economic evolution of metropolitan areas in the US southern border states, thereby contributing to the literature from a contemporary economic development  perspective. 


Given the volume of immigrants moving from California to Arizona, during the last decades, and the regional economic development opportunities created recently, the Phoenix MSA, represent an interesting case study, where housing pricing trends and geographic attributes provide valuable insights to understand peoples incentives to relocate. 


This metropolitan area is located in Maricopa County at the heart of the Arizona desert, and is situated in close proximity to the Mexican border. To document another significant aspect of migration patterns in this chapter, we will provide evidence of the flow of income across state borders, relying on official records maintained by the Internal Revenue Service (IRS). 

In addition, we examine homelessness trends and policies addressing this critical social issue, often associated with housing affordability challenges, which hold particular significance for metropolitan areas in California and other urban areas across the country. According to the US Congress, the problem of homelessness has become more severe and, in the absence of more effective efforts, is expected to become dramatically worse, [@legalinformationinstituteCode113012023].

From an empirical perspective, analyzing homelessness is of particular importance when studying the California housing market. This significance arises due to the financial barriers that hinder market access in this region of the country, which often prevents homeless population from exiting this vulnerable condition. Furthermore, the State has demonstrated robust public policy support, evident in leading initiatives currently in place and undergoing testing, notably those addressing eviction restrictions, critical,in the aftermath of historical events that exacerbated the homeless problem in the state, such as the covid-19 global health emergency. And measures related to provide shelter

From a theoretical stand point, however, it is well documented that the causes of homelessness are many and complex, and homeless, individuals or families, have diverse needs. Common determinants point-out by scholars specializing on the topic include: mental Health issues, substance abuse, and family instability. From a sociological perspective, social isolation and lack of social support [@isolation; @isolation_mental] has been investigated worldwide as triggers contributing to this condition. 

However, in this chapter I focus the attention on economic factors, in fact currently data on homeless population across US states and metropolitan areas indicate that the higher proportion of homeless population in the US is found in California [@nationalalliancetoendhomelessnessStateHomelessness20232023]. California, as documented elsewhere, is home to 12% of the USA's population, but to 30% of the nation’s homeless population, some 170,000 people [@calihomeless], and is at the same time, as shown in the previous chapter, the state with the most expensive housing market in the country. 

Despite its nature, the raising homelessness problem has been approached by units of local government and private voluntary organizations with mixed results in light of the available resources. 

The efficient allocation of resources is critical, therefore, a deep understanding of the causes can provide valuable insights to policy makers and practitioners including social workers and local providers of services to design strategies to mitigate this pressing social issue, by definition related to the housing market. 

Furthermore, to provide a conceptual understanding about the economic forces shaping the housing market, in addition to demand related determinants studied in previous chapters such as house prices or personal income, it is paramount to analyze supply side factors,  for this task the present chapter covers  new single-family and multifamily housing units construction trends  including statistics on sales of new single-family houses. 

## Data and methods. 

In this chapter, we conduct exploratory data analysis using the integrated development environment for  RStudio, a programming language suitable for statistical computing and graphics.  Additionally, API calls are applied via jupyter notebook,  a web-based interactive computing platform from Python programming language to access US Census Bureau official data. 


We uncover the significant effects of migration across state borders from the perspective of taxation and revenue in both the origin and destination metropolitan areas. Internal Revenue Service data provides an opportunity to quantify revenue losses in the origin metropolitan areas while demonstrating the positive contributions to the host area's economy.

There are three main sources of information considered to conduct this analysis.

First, supply side determinants are studied base on the US census Bureau Survey of Construction, a product whose purpose is to provide national and regional statistics on starts and completions of new single-family and multifamily housing units and statistics on sales of new single-family houses in the United States,[@soc]. The frequency of this survey is monthly and annual. A key variable of interest from this survey for this analysis is construction authorizations for new units which are summarized  as the total number of building permits for a given month or year. 

In addition to housing supply data from the supply side, tax-related information is derived from records maintained by the Internal Revenue Service (IRS). Within this conceptual framework, tax data provide a supplementary perspective on population movements. To approximate migration, the IRS records year-to-year address changes reported in individual income tax returns filed using IRS Form 1040 

This approach specifically records the number of residents who relocated to a particular state or county, along with the location from which they moved [@internalrevenueserviceMigrationDataUsers2021]. The data corresponds to the calendar year 2020-2021, representing income earned during 2020, and stands as the most up-to-date information available at the time of writing this book.

According to the Internal Revenue Service (IRS), this dataset reflects the situation prior to late September of each calendar year and represents between 95 and 98 percent of total annual filings [@internalrevenueserviceMigrationDataUsers2021]. Therefore, it offers a arguably comprehensive foundation for assessing this topic on a geographically relevant scale. Additionally, this source furnishes demographic details, including the age of the taxpayer, which proves valuable in enhancing our comprehension of migrant income profiles.

Finally, the analysis includes homeless records from the U.S. Department of Housing and Urban Development (HUD).^[or purposes of this chapter, the terms “homeless”, “homeless individual”, and “homeless person” means an individual or family who lacks a fixed, regular, and adequate nighttime residence.]


## Constructions Permits, supply side constraints and rapid development: two faces of the same coin. 


Construction permits for new homes are key variable to 


## Revenue landscapes for origin and destination metropolitan areas.

Considering population flows across state lines, the analysis indicates that California is the main contributor of out of state migration in the U.S. representing  one out of three  or $30.4\%$  of the total out of state IRS return filings.


## Affordability, price out affect and homelesness. 

Here most include delinquency rates (mortgage default)  from freddie mac data base,   
try  a regression model for price out effect 

D= income+population + prices HPI or regional price parity hoousing. 

On this topic, see paper https://www.gotoby.com/userfiles/documents/How%20Fees%20Force%20Home%20Buyers%20Out%20of%20the%20Market.pdf
affordability standard: ability to qualify for a mortgage. To qualify for conventional loans, housing expenses should not exceed **28 percent of homebuyers’ gross monthly income.**

```{r}
po2014<-read.csv("2014-price-out.csv")
```



So here we may need a price to income ratio. 
The affordability standard is thus a
ratio of housing expenses to income, and the number of households that qualify for a mortgage to buy a home of a given
price will depend on the income of households in an area and current mortgage rates. 

Sources for this approach: 
The American Community Survey (ACS) or  median family income published by the Department of Housing and Urban Development (HUD)

Goood idea here is to include density kernels to show income across demographic groups and selected Metro areas.  Totaly important include Californian MSA such as Sunnyvale or Los Angeles, the main exporter of population in the state. 

**Assumptions:** Other assumptions used in the priced out calculations are a down payment equal to 10 percent of the purchase price and a *30-year fixed rate mortgage*
Some other methodological issues: 
The ACS reports both median home values and real estate taxes paid and, thus, allows estimating the effective property tax rates for all metro areas. For the US, the median rate
is $12 per $1,000 of property value. Property hazard insurance rates are constructed based on the 2007 ACS Public Use
Microdata Sample (PUMS)3
. For the US as a whole, the insurance rates work out to $5 per $1,000 of property value. 
Map homeless trends. 
To estimate median new home prices for states and metropolitan areas, NAHB relies on data reported by the 2013
Census Bureau’s Building Permits Survey and Survey of Construction (SOC). 



```{r, include=FALSE}
###populaiocesusdaa

###https://www.census.gov/data/developers/data-sets/popest-popproj/popest.Vintage_2019.html#list-tab-2014455046

### DATA WRANGLING FOR CONSTRUCTION PERMITS  ###

###################################################

#SOURCE: https://www.census.gov/construction/bps/msamonthly.html Survey of Construction. tOTAL  INCLUDES SINGLE unit  two units, three unit  and 5 or more units. permits refers to construction authorizations.  https://www.census.gov/construction/nrc/historical_data/index.html
# See definitions at:  https://www.census.gov/construction/nrc/definitions/bps.html

# Note. To use population census data  and construction permits to estimate the location quotient (to measure the relative concentration of construction activity controlling by population size ), we have the most up to date 2019 population estimates  and we can use 2019 permits data. Although there is data for construction for up to 2020. We are not able to use it because of the restriction in the US census bureau data.


# Data on construction permits for 2019 by msa
permits<-read.csv("permits2019.csv")%>%
separate(msa, into = c("msa", "state"), sep = ",", remove = TRUE)%>%mutate(t=sum(permits2019))

# Data on population by MSA  for 2019  ACS  estiamte. 

pop2019<-read.csv("pop2019.csv")%>%
  rename(code=metropolitan.statistical.area.micropolitan.statistical.area)

lq<-permits%>%left_join(pop2019)

lq<-lq%>%mutate(tpop=sum(POP), num=(permits2019/POP)*100, den=(t/tpop)*100)%>%
mutate(lq2019=round((num/den)*100,2))

medianlq<-lq%>%summarize(m=median(lq2019))

lq<-lq%>%mutate(lq2019=round((num/den)*100/medianlq$m,2)) 
  
  lq$state <- str_replace_all(lq$state, "\\s+", "")


AZ.CA<-lq%>%filter(state=="CA"|state=="AZ")

```

```{r, include=FALSE}
library(scales)

## Only border.

#only_border2020<-readRDS("df_inc_pop_hpi2020.rds")%>%mutate(state=as.factor(state))%>%select(cbsa_code, hpi)%>%rename(code=cbsa_code)


#lqborder<-lq%>%left_join(only_border2020)%>%na.omit()%>%mutate(state=as.factor(state))
#levels(lqborder$state)

#lqborder$state <- str_replace_all(lqborder$state, "\\s+", "")





#ggplot(lqborder, aes(POP, lq, group=1,linewidth = POP,colour = state,label=msa)) +geom_point(alpha = 0.7) +scale_size(range = c(1, 6))  +scale_colour_manual(values = c("red","blue", "darkgoldenrod4", "grey"))+geom_smooth(method = "lm", se = FALSE) +labs(x = "Population", y = "Permits2019", title = "Linear Trend Between Population and Permits2019") +theme_minimal()+scale_x_log10(labels =  comma )
```


