# Feeling the heath: The California-Maricopa route, in search for affordable housing.

```{r, include=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)

```


In this chapter, the aim is to analyze how regional migration flows from California  have search to new destinations such as the Phoenix Metropolitan area. contributing to its recent development. 
This MSA, located in Maricopa County on the Arizona desert heartland, is situated in close proximity to the Mexican border. We will provide evidence, based on Internal Revenue Service (IRS) records, to document another significant aspect of migration patterns: the flow of income across state borders.

In addition, we examine homelessness trends and policies addressing this critical social issue, often associated with housing affordability challenges, which hold particular significance for metropolitan areas in California and other urban areas across the country. 

## Data and methods. 

In this chapter, we conduct exploratory data analysis using the integrated development environment for R, a programming language suitable for statistical computing and graphics.  Additionally, API calls are applied via jupyter notebook,  a web-based interactive computing platform from Python programming language to access US Census Bureau official data. 


we uncover the significant effects of migration across state borders from the perspective of taxation and revenue in both the origin and destination metropolitan areas. Internal Revenue Service data provides an opportunity to quantify revenue losses in the origin metropolitan areas while demonstrating the positive contributions to the host area's economy.

There are three  main sources of information considered to conduct this analysis.

First, supply side determinants are studied base on  the US census Bureau Survey of Construction, a product whose purpose is to provide national and regional statistics on starts and completions of new single-family and multifamily housing units and statistics on sales of new single-family houses in the United States,[@soc]. The frequency of this survey is monthly and annual. A key variable of interest from this survey for this analysis is construction authotrizations for new units which are summarized   as the total number of building permits for a given month or year. 

In addition to supply side housing data, taxation information comes from the Internal Revenue Service (IRS). In this conceptual strategy, Tax data represent a complementary view of population movements.  In order to approximate migration, the IRS records year-to-year address changes reported on individual income tax returns filed and documented by IRS Form 1040. 

In particular this approach records the number of residents that moved to a State or county and the origin from where they moved [@internalrevenueserviceMigrationDataUsers2021]. Data corresponds to calendar year 2020-2021, So it represents income earned during 2020. the most up to date information available at the moment of writing this book. 

According to the IRS,this data captures the situation prior to late September of each calendar year and represent between 95 and 98 percent of total annual filings[@internalrevenueserviceMigrationDataUsers2021], so it provides an arguably complete base scenario to evaluate this topic at a geographic suitable scale.
In addition this source provides demographic details such as the age of the tax payer, which is valuable to better understand migrants incomes profiles.

Finally, the analysis includes homeless data base on records form the ....

## Constructions Permits, supply side constraints and rapid development: two faces of the same coin. 


Construction permits for new homes are key variable to 


## Revenue landscapes for origin and destination metropolitan areas.

Considering population flows across state lines, the analysis indicates that California is the main contributor of out of state migration in the U.S. representing  one out of three  or $30.4\%$  of the total out of state IRS return filings.


## Affordability, price out affect and homelesness. 

Here most include delinquency rates (mortgage default)  from freddie mac data base,   
try  a regression model for price out effect 

D= income+population + prices HPI or regional price parity hoousing. 

On this topic, see paper https://www.gotoby.com/userfiles/documents/How%20Fees%20Force%20Home%20Buyers%20Out%20of%20the%20Market.pdf
affordability standard: ability to qualify for a mortgage. To qualify for conventional loans, housing expenses should not exceed **28 percent of homebuyers’ gross monthly income.**
```{r}
po2014<-read.csv("2014-price-out.csv")



```



So here we may need a price to income ratio. 
The affordability standard is thus a
ratio of housing expenses to income, and the number of households that qualify for a mortgage to buy a home of a given
price will depend on the income of households in an area and current mortgage rates. 

Sources for this approach: 
The American Community Survey (ACS) or  median family income published by the Department of Housing and Urban Development (HUD)

Goood idea here is to include density kernels to show income across demographic groups and selected Metro areas.  Totaly important include Californian MSA such as Sunnyvale or Los Angeles, the main exporter of population in the state. 

**Assumptions:** Other assumptions used in the priced out calculations are a down payment equal to 10 percent of the purchase price and a *30-year fixed rate mortgage*
Some other methodological issues: 
The ACS reports both median home values and real estate taxes paid and, thus, allows estimating the effective property tax rates for all metro areas. For the US, the median rate
is $12 per $1,000 of property value. Property hazard insurance rates are constructed based on the 2007 ACS Public Use
Microdata Sample (PUMS)3
. For the US as a whole, the insurance rates work out to $5 per $1,000 of property value. 
Map homeless trends. 
To estimate median new home prices for states and metropolitan areas, NAHB relies on data reported by the 2013
Census Bureau’s Building Permits Survey and Survey of Construction (SOC). 

```{r}
71059/240384
```



```{r, include=FALSE}
###populaiocesusdaa
###https://www.census.gov/data/developers/data-sets/popest-popproj/popest.Vintage_2019.html#list-tab-2014455046

### DATA WRANGLING FOR CONSTRUCTION PERMITS  ###

###################################################

#SOURCE: https://www.census.gov/construction/bps/msamonthly.html Survey of Construction. tOTAL  INCLUDES SINGLE unit  two units, three unit  and 5 or more units. permits refers to construction authorizations.  https://www.census.gov/construction/nrc/historical_data/index.html
# See definitions at:  https://www.census.gov/construction/nrc/definitions/bps.html

# Note. To use population census data  and construction permits to estimate the location quotient (to measure the relative concentration of construction activity controlling by population size ), we have the most up to date 2019 population estimates  and we can use 2019 permites data. Although there is data for construction for up to 2020. We are not able to use it because of the restriction in the US census bureau data.


# Data on consruction permits for 2019 by msa
permits<-read.csv("permits2019.csv")%>%
separate(msa, into = c("msa", "state"), sep = ",", remove = TRUE)%>%mutate(t=sum(permits2019))

# Data on population by MSA  for 2019  ACS  estiamte. 

pop2019<-read.csv("pop2019.csv")%>%
  rename(code=metropolitan.statistical.area.micropolitan.statistical.area)

lq<-permits%>%left_join(pop2019)

lq<-lq%>%mutate(tpop=sum(POP), num=(permits2019/POP)*100, den=(t/tpop)*100)%>%
mutate(lq2019=round((num/den)*100,2))

medianlq<-lq%>%summarize(m=median(lq2019))

lq<-lq%>%mutate(lq2019=round((num/den)*100/medianlq$m,2)) 
  
  lq$state <- str_replace_all(lq$state, "\\s+", "")

000
AZ.CA<-lq%>%filter(state=="CA"|state=="AZ")

```

```{r, include=FALSE}
library(scales)

## Only border.

#only_border2020<-readRDS("df_inc_pop_hpi2020.rds")%>%mutate(state=as.factor(state))%>%select(cbsa_code, hpi)%>%rename(code=cbsa_code)


#lqborder<-lq%>%left_join(only_border2020)%>%na.omit()%>%mutate(state=as.factor(state))
#levels(lqborder$state)

#lqborder$state <- str_replace_all(lqborder$state, "\\s+", "")





#ggplot(lqborder, aes(POP, lq, group=1,linewidth = POP,colour = state,label=msa)) +geom_point(alpha = 0.7) +scale_size(range = c(1, 6))  +scale_colour_manual(values = c("red","blue", "darkgoldenrod4", "grey"))+geom_smooth(method = "lm", se = FALSE) +labs(x = "Population", y = "Permits2019", title = "Linear Trend Between Population and Permits2019") +theme_minimal()+scale_x_log10(labels =  comma )
```


