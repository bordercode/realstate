# House prices as internal migration determinants.

```{r, echo=FALSE, include=FALSE, message=FALSE, warning=FALSE}
library(dygraphs)
library(mapview)
library(leafem)
library(tidyverse)
library(sf)
library(leaflet)
library(gganimate)
library(gifski)
library(png)
library(ggrepel)
library(scales)
library(plotly)
library(ggthemes)
library(xts)
library(zoo)
library(htmltools)
library(stringr)
library(broom)
library(ggeasy)
library(usmap) 

library(TSstudio)

```


From an economic perspective, house prices represent a main component of inflation, overall price level trends are currently a priority for economic policy in general and particularly relevant when studying residential mobility.

Empirical evidence reported by current academic research  [@https://doi.org/10.1002/psp.2412] as well as market experts [@s&p/case-shillerEconomicData2023], indicate that, beyond labor market incentives, housing affordability represent a key factor when considering the selection of a place to reside [@FUSS201635].

In fact, real state markets may play a critical role for important social processes such as migration, both internal (within the same country)^[For the purposes of this investigation, internal migration is defined as the change in residence location from one particular Metropolitan area to another] or international. 

In this chapter, exploratory data analysis is conducted on house property values, focusing on metropolitan areas as the geographic scale across the US.  

Metropolitan areas are geographic units that are particularly suited to understand regional real state dynamics and provide a base scenario to study internal migration patterns within the US territory as well as specific regions such as the US-Mexico border.

## Data and methods.

The study strategy follows a spatial and temporal design, it is argued that analyzing housing costs evolution in a geographic context may reveal patterns that help to better understand residential mobility and deliver valuable insights about internal migration flows and the underlying regional economic incentives.

The primary spatial unit of analysis for this study is the Metropolitan Statistical area (MSAs). MSAs are geographical regions defined by the Office of Management and Budget (OMB) that consist of one or more counties that contain a core city of 50,000 or more inhabitants, and surrounding areas with significant social and economic ties [@ofr1990federalregister]. 

It is argued that Metropolitan statistical areas provide an appropriate level of detail, improving over the aggregate perspective that states offer or the traditional county boundaries scale, which lack the economic synergies and the broad social component that MSAs achieve by considering the interaction between a core and a set of adjacent communities. For this theoretical considerations MSAs were selected over other alternative geographical scales for this particular analysis. 

The study covers all 48 continental adjacent US states, excluding: District of Columbia, Alaska and non continental territories Hawaii and Puerto Rico.

A primary goal is to explore real state market fluctuations over time, to achieve this purpose we measure three concepts: house price levels, price appreciation and purchasing parity based on housing prices. 

To measure house price levels the main input variable is the quarterly seasonally adjusted house price index for the period 1991:Q1 (base year) to 2022:Q4 for 387 MSAs for which  Federal housing finance agency  (FHFA) price indices are available. 

The FHFA House Price Index (FHFA HPI) is a broad economic measure of the movement of single family house prices in the United States [@fhfaHousePriceIndex2022].  The data set analyzed in this chapter contains purchase only  transactions, the aim is to capture the price level fluctuations a feature estimated by using sales price data as opposed to appreciation. (which considers a repet transaction methodology.

To measure the underlying rate of appreciation of a given house price, the Freddie Mac House price index (FMHPI), is incorporated. This is a repeat transaction index, which compares the price of the same property over two or more transactions and is explicitly designed to capture appreciation while holding constant basic factors such as physical location, climate, housing type, etc.,between transactions. [@freddiemacFreddieMacHouse2023].

By construction, therefore, the repeat transaction requirement exclude new homes.

Whereas HPI in data sets such as FHFA, measures current price level not considering transactions over the same property.  

To complement the perspective obtained by the Federal housing finance agency HPI data and the Freddie Mac HPI,  the housing component of the regional price parities (RPPs) indicator for year 2022 (the latest release as the time of writing this investigation) is included.

This is an official indicator reported by the Bureau of economic analysis (BEA) which measure the differences in price levels across states and metropolitan areas for a given year and are expressed as a percentage of the overall national price level[@bureauofeconomicanalysisRegionalPriceParities2023]. 

This indicator is particularly informative of the population purchasing power, specially it allows price comparisons relative to the national average.

To capture demand side factors, Official population estimates from the US Census Bureau were obtained for years 2010-2020 [@uscensusbureauPopulationEstimatesEstimated2023, this is a variable that captures demographic dynamics overtime and serve as a proxy for housing demand.  

Per capita personal Income (PPI) by metropolitan area from the U.S. Bureau of Economic Analysis is also included.
[@bureauofeconomicanalysisPersonalIncomeCounty2023]. This variable contributes to capture inequality and financial barriers to access the housing market. In addition the income to house price ratio is useful to inform on the contextual factors affecting the decisions to move. 

A second goal is to emphasize the impact of monetary policy shifts on housing demand by examining time series data for interest rates. Specifically, we analyze how changes in interest rates influence the demand for home loans, which, in turn, has a significant effect on home prices.

Interest rates serve as a crucial economic indicator that directly affects the demand for housing. By exploring the dynamics of interest rates over time, we aim to shed light on the influential role they play in shaping housing market trends in the presence of external economic shocks, particularly important during the study period we document: a)  the effect of the so called great recession related to the sub-prime mortgage market collapse in 2009 and b) the global health emergency declaration of early 2020.

A third goal is to analyze non-conventional economic data^[Conventional economic data is defined for the purposes of this investigation as repositories generated by the Census Bureau, Bureau of economic analysis and federal agencies and institutions that provide estimates, projections and indicators related to the housing market], to understand the population sentiment towards the housing market, we propose the use of the Google trends tool. 

This tool provides insights into the relative popularity of search terms over a particular period of time and across different regions. And it has become a relevant source for academic research recently from areas in the social sciences field as wellas other disciplines such as natural sciences and public health. [@askitasTrendSpottingHousingMarket2016], [@avramescuNowcastingRomanianMigration2021], [@vazquezGRANDESDATOSGOOGLE2020], [@kamMonitoringDroughtAwareness2019].

By analyzing the search volume data obtained from Google, Google Trends allows us to observe and compare the changes in interest and search patterns for various topics using a score in the close domain [0-100], where 100 indicates the highest volume of searches for a particular and 0 indicates the lowest volume for the term at a precise moment in time and location.

By analyzing the search behavior of internet users, Google Trends offers a valuable resource for understanding the relative level of interest and attention that a topic or keyword generates within the online population. We analyze three important words that characterize equal number of aspects for the housing markets: affordable home, Foreclosure and eviction. 
This keywords allow to answer questions on where an when does people (Google users) are looking for this words, specially the term Foreclosure, serve as a proxy for home owners interest whereas eviction represents the renterÂ´s segment. 


### Exploratory data analysis.

The analysis is organized in two stages: the first provides a national approach to the housing prices fluctuations for state and MSA scales. While the second focuses on the US Mexico border region.

When we analyze real estate market fluctuations in the context of affordability housing, understanding regional inflation patterns is crucial, in particular in this section the analysis starts by exploring the housing component for the regional price parity (RPP), this is an indicator developed by the Bureau of Economic Analysis (BEA) to measure price fluctuations at a regional scale. 

Examining this aggregate economic indicator it is possible to distinguish which states of the country exhibit the most expensive housing markets and therefore which areas of the country represent particular challenges either for households entering the market or those families already paying a mortgage. 


Regional price parties capture variations in the cost of living across different region of the country, this indicator is important because it helps to understand the relative purchasing power and living standards in different geographic areas and particularly when considering the housing component, it provides a measure to compare the real estate market conditions relative to the country.  

The RPP base level is the national average which takes a value of 100, so RPP values above this national threshold indicate relative more expensive states in terms of housing prices.

Figure 1 shows regional price parities by state relative the average US for 2021.  


```{r, echo=FALSE}

### Plot  For Regional price parities for the housing component

## Loading the data set.   REGIONAL PRICE PARITIES
# Source: 

prices<-read.csv("prices.csv")%>%
  mutate(type=as.factor(type), type=ifelse(type==0, "Below avg", "Above avg"))%>%
  filter(!row_number() %in% 9)%>%
  filter(state!="Alaska" &  state!="Hawaii")

### Plot  

rppp<-ggplot(prices, aes(x = reorder(state,rppindex), y=rppindex, fill = type))+ 
  geom_col()+  
  coord_flip()+
  theme_minimal()+
labs(fill="RPP")+
theme(legend.justification=c(1,0), legend.position=c(.9,.4))+
ylab("Regional Price Parities (RPP) 2022. Housing component. (%) Deviation")+
xlab("State")+
annotate("text", x="Alabama", y=50, size=3.1,label="US Housing RPP=100 per cent")+
  annotate("text", x="California", y=70, size=3.1,label="64.9")+
  annotate("text", x="Arizona", y=6, size=3.1,label="2.4")+   annotate("text", x="Texas", y=-8, size=3.1,label="-4.4")+ 
   annotate("text", x="NewMexico", y=-30, size=3.1,label="-27")+
scale_fill_manual(values=c("deepskyblue4","firebrick"), labels=c("Below average","Above average" ))+
  theme(legend.position = "bottom", legend.title = element_blank()) 

ggplotly(rppp)%>%
  layout(legend = list(orientation = "h", x = 0.4, y = -0.2))
 #ggsave("rpp2022_housing_USstates.tiff", width = 25, height = 17, units = "cm",dpi=300)
```
Source: JosÃ© Luis Manzanares analysis of Regional price parities data 2021 [@bureauofeconomicanalysisRegionalPriceParities2023]


It can be seen that the Us west coast border state of California has the highest housing price parity among the 48 states (excluding Hawaii and Alaska) for 2021. This  pattern suggest financial pressures for residents in west coast states that may explain the current out of state internal migration documented by academic research elsewhere [@blumenbergJobsHousingBalance2021] for states such as California.

In order to get a higher level of detail on the behavior of house price fluctuations,  metropolitan statistical areas around the country are now analyzed, considering the House price index developed by the Federal Home Loan Mortgage Corporation^[Freddie Mac, indicated as FM for further reference in this work], this measure is explicitly designed to capture appreciation of the housing market as discussed in the methodology section of this chapter.  

The data analysis strategy design aims to extract the appreciation over a two decade time frame for each metropolitan area, so, we are able to measure not only which metropolitan areas have registered the bigger price gains between 2000 and 2020 but also itÂ´s annual rate of growth. 

Measuring appreciation using the HPI developed by a government sponsored enterprise such as the FM, is important for two reasons in the context of this investigation: I) It informs on the potential changes on home equity fluctuations over time with a geographic perspective, which expose real estate investment opportunities  II) It reflects existing financial barriers and/or opportunities to entry into the housing market for household looking to relocate, so is an appropriate economic indicator that  helps to explain  current internal migration patterns.  

The following interactive map shows the resulting representation  the House Price index (HPI),  for the 387 U.S. Metropolitan statistical areas as of 2020. Each circle represents a HPI measure with its size corresponding to the HPI value.T

he index depicts housing market prices taking as base year 1991. So higher values indicate a relative appreciation and therefore more expensive locations than those with smaller circles.   

