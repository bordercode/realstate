# House prices, interest rates and investment opportunities. 



```{r, echo=FALSE, include=FALSE, message=FALSE, warning=FALSE}
library(dygraphs)
library(mapview)
library(leafem)
library(tidyverse)
library(sf)
library(leaflet)
library(gganimate)
library(gifski)
library(png)
library(ggrepel)
library(scales)
library(plotly)
library(ggthemes)
library(xts)
library(zoo)
library(htmltools)
library(stringr)
library(broom)
library(ggeasy)
library(usmap) 
library(htmlwidgets)
```


From an economic perspective, house prices represent a main component of inflation, overall price level trends are currently a priority for economic policy in general and particularly relevant when studying residential mobility.

Empirical evidence reported by current academic research  [@https://doi.org/10.1002/psp.2412] as well as market experts [@s&p/case-shillerEconomicData2023], indicate that, beyond labor market incentives, housing affordability represent a key factor when considering the selection of a place to reside [@FUSS201635].

In fact, real state markets may play a critical role for important social processes such as migration, both internal (within the same country)^[For the purposes of this investigation, internal migration is defined as the change in residence location from one particular Metropolitan area to another] or international. 

In this chapter, exploratory data analysis is conducted on house property values, focusing on metropolitan areas as the geographic scale across the US.  

Metropolitan areas are geographic units that are particularly suited to understand regional real state dynamics and provide a base scenario to study internal migration patterns within the US territory as well as specific regions such as the US-Mexico border.

## Data and methods.

The study strategy follows a spatial and temporal design, it is argued that analyzing housing costs evolution in a geographic context may reveal patterns that help to better understand residential mobility and deliver valuable insights about internal migration flows and the underlying regional economic incentives.

The primary spatial unit of analysis for this study is the Metropolitan Statistical area (MSAs). MSAs are geographical regions defined by the Office of Management and Budget (OMB) that consist of one or more counties that contain a core city of 50,000 or more inhabitants, and surrounding areas with significant social and economic ties [@ofr1990federalregister]. 

It is argued that Metropolitan statistical areas provide an appropriate level of detail, improving over the aggregate perspective that states offer or the traditional county boundaries scale, which lack the economic synergies and the broad social component that MSAs achieve by considering the interaction between a core and a set of adjacent communities. For this theoretical considerations MSAs were selected over other alternative geographical scales for this particular analysis. 

The study covers all 48 continental adjacent US states, excluding: District of Columbia, Alaska and non continental territories Hawaii and Puerto Rico.

A primary goal is to explore real state market fluctuations over time, to achieve this purpose we measure three concepts: house price levels, price appreciation and purchasing parity based on housing prices. 

To measure house price levels the main input variable is the quarterly seasonally adjusted house price index for the period 1995:Q1 (base year) to 2022:Q4 for 387 MSAs for which  Federal housing finance agency  (FHFA) price indices are available. 

The FHFA House Price Index (FHFA HPI) is a broad economic measure of the movement of single family house prices in the United States [@fhfaHousePriceIndex2022].  The data set analyzed in this chapter contains purchase only  transactions, the aim is to capture the price level fluctuations a feature estimated by using sales price data as opposed to appreciation. (which considers a repeat transaction methodology).

To measure the underlying rate of appreciation of a given house price, the Freddie Mac House price index (FMHPI), is incorporated. This is a repeat transaction index, which compares the price of the same property over two or more transactions and is explicitly designed to capture appreciation while holding constant basic factors such as physical location, climate, housing type, etc.,between transactions. [@freddiemacFreddieMacHouse2023].

By construction, therefore, the repeat transaction requirement exclude new homes.

Whereas HPI in data sets such as FHFA, measures current price level not considering transactions over the same property.  

To complement the perspective obtained by the Federal housing finance agency HPI data and the Freddie Mac HPI,  the housing component of the regional price parities (RPPs) indicator for year 2022 (the latest release as the time of writing this investigation) is included.

This is an official indicator reported by the Bureau of economic analysis (BEA) which measure the differences in price levels across states and metropolitan areas for a given year and are expressed as a percentage of the overall national price level [@bureauofeconomicanalysisRegionalPriceParities2023]. 

This indicator is particularly informative of the population purchasing power, specially it allows price comparisons relative to the national average.

To capture demand side factors, Official population estimates from the US Census Bureau were obtained for years 2010-2020 [@uscensusbureauPopulationEstimatesEstimated2023], this is a variable that captures demographic dynamics overtime and serve as a proxy for housing demand.  

Per capita personal Income (PPI) by metropolitan area from the U.S. Bureau of Economic Analysis is also included.
[@bureauofeconomicanalysisPersonalIncomeCounty2023]. This variable contributes to capture inequality and financial barriers to access the housing market. In addition the income to house price ratio is useful to inform on the contextual factors affecting the decisions to move. 

A second goal of this chapter is to reveal the impact of monetary policy shifts on housing demand by examining time series data for interest rates. Specifically, we analyze how changes in interest rates influence the demand for home loans, which, in turn, has a significant effect on home prices.

Interest rates serve as a crucial macroeconomic indicator that directly affects the demand for housing. By exploring the dynamics of interest rates over time, we aim to shed light on the influential role they play in shaping housing market trends in the presence of external economic shocks, particularly important during the study period we document: a)  the effect of the so called "Great Recession" related to the sub-prime mortgage market collapse in 2009 and b) the global health emergency declaration of early 2020.

A third goal is to analyze non-conventional economic data^[Conventional economic data is defined for the purposes of this investigation as repositories generated by the Census Bureau, Bureau of economic analysis and federal agencies and institutions that provide estimates, projections and indicators related to the housing market], to understand the population sentiment towards the housing market, we propose the use of the Google trends tool. 

This tool provides insights into the relative popularity of search terms over a particular period of time and across different regions. And it has become a relevant source for academic research recently from areas in the social sciences field as well as other disciplines such as natural sciences and public health. [@askitasTrendSpottingHousingMarket2016], [@avramescuNowcastingRomanianMigration2021], [@vazquezGRANDESDATOSGOOGLE2020], [@kamMonitoringDroughtAwareness2019].

By analyzing the search volume data obtained from Google Trends, this data source allows us to observe and compare the changes in interest and search patterns for various topics using a score in the close domain [0-100], where 100 indicates the highest volume of searches for a particular place and time and 0 indicates the lowest volume for the term at a precise moment in time and location.

By analyzing the search behavior of internet users, Google Trends offers a valuable resource for understanding the relative level of interest and attention that a topic or keyword generates within the online population. We analyze three important words that characterize equal number of aspects for the US housing markets: affordable home, Foreclosure and eviction. 
This keywords allow to answer questions on where and when does people (Google users) are looking for this words, specially the term Foreclosure, serve as a proxy for home owners interest whereas eviction represents the renter´s segment. 


## Results.

The analysis is organized in two stages: the first provides a national approach to the housing prices fluctuations for state and MSA scales. While the second focuses on the US Mexico border region.

When we analyze real estate market fluctuations in the context of affordability housing, understanding regional inflation patterns is crucial. In particular in this section the analysis starts by exploring the housing component for the regional price parity (RPP), this is an indicator developed by the Bureau of Economic Analysis (BEA) to measure price fluctuations at a regional scale. 

By xamining this aggregate economic indicator it is possible to distinguish which states of the country exhibit the most expensive housing markets and therefore which areas of the country represent particular challenges either for households entering the market or those families already paying a mortgage. 


Regional price parties capture variations in the cost of living across different region of the country, this indicator is important because it helps to understand the relative purchasing power and living standards in different geographic areas and particularly when considering the housing component, it provides a measure to compare the real estate market conditions relative to the country.  

The RPP base level is the national average which takes a value of 100, so RPP values above this national threshold indicate relative more expensive states in terms of housing prices.

Figure 1 shows regional price parities by state relative the average US for 2021

[Figure 1 Regional price parities (RPP) by state 2022](../speech/F1_rpp.html).  
```{r, echo=FALSE, warning=FALSE,message=FALSE}

### Plot  For Regional price parities for the housing component

## Loading the data set.   REGIONAL PRICE PARITIES
# Source: 

prices<-read.csv("prices.csv")%>%
  mutate(type=as.factor(type), type=ifelse(type==0, "Below avg", "Above avg"))%>%
  filter(!row_number() %in% 9)%>%
  filter(state!="Alaska" &  state!="Hawaii")


### Plot  

rppp<-ggplot(prices, aes(x = reorder(state,rppindex), y=rppindex, fill = type))+ 
  geom_col()+  
  coord_flip()+
  theme_minimal()+
labs(fill="RPP")+
theme(legend.justification=c(1,0), legend.position=c(.9,.4))+
ylab("Housing component of RPP. (%) Deviation")+
xlab("State")+
annotate("text", x="Alabama", y=50, size=3.1,label="US Housing RPP=100 per cent")+
  annotate("text", x="California", y=70, size=3.1,label="64.9")+
  annotate("text", x="Arizona", y=6, size=3.1,label="2.4")+   annotate("text", x="Texas", y=-8, size=3.1,label="-4.4")+ 
   annotate("text", x="NewMexico", y=-30, size=3.1,label="-27")+
scale_fill_manual(values=c("deepskyblue4","firebrick"), labels=c("Below average","Above average" ), name="")+
  theme(legend.position = "bottom", legend.title = element_blank()) 

ggplotly(rppp)%>%
  layout(legend = list(orientation = "h", x = 0, y = -.05))

#htmlwidgets::saveWidget(widget = rppplot, 
#the plotly object file = "C:/Users/josel/Desktop/on/I/2023/HOUSING/realstate/speech/F1_rpp.html", 
#the path & file name selfcontained = TRUE #creates a single html file)


 #ggsave("rpp2022_housing_USstates.tiff", width = 25, height = 17, units = "cm",dpi=300)
```
Source: José Luis Manzanares analysis of Regional price parities based on data from [@bureauofeconomicanalysisRegionalPriceParities2023]


It can be seen that the US west coast border state of California has the highest housing price parity among the 48 states (excluding Hawaii, Alaska and DC) for 2021. This  pattern suggest financial pressures for residents in west coast states that may influence the current out of state internal migration documented by academic research elsewhere [@blumenbergJobsHousingBalance2021] for states such as California.

In order to get a higher level of detail on the behavior of house price fluctuations,  metropolitan statistical areas around the country are now analyzed, considering the House price index developed by the Federal Housing Finance Agency, ^[indicated as FHFA for further reference in this work], this measure is explicitly designed to capture fluctuations of the housing market since it includes prices of new homes as discussed in the methodology section of this chapter.  

The data analysis strategy design aims to extract the changes in prices over a two decade time frame for each metropolitan area so, we are able to measure not only which metropolitan areas have registered the bigger price gains between 2000 and 2020 but also it´s annual rate of growth. 

Measuring price fluctuations using the HPI developed by an independent federal agency such as FHFA, is important for two reasons in the context of this investigation: I) It informs on the potential changes on home equity fluctuations over time with a geographic perspective, which expose real estate investment opportunities  II) It reflects existing financial barriers and/or opportunities to entry into the housing market for households looking to relocate, so is an appropriate economic indicator that helps to explain  current internal migration patterns.  

Figure 2 below shows the House Price index (HPI) distribution across the 387 U.S. Metropolitan statistical areas as of 2020. Each circle represents a HPI measure with its size corresponding to the HPI value.

The index depicts housing market prices taking 1995 as base year.  So higher values indicate a relative average increase overtime and therefore more expensive locations than those with smaller circles.   

[Figure 2 Home price index HPI ](../speech/F2map.html).

```{r,  warning=FALSE, message=FALSE, echo=FALSE}

## This datas set contains 387   MSA as of  2020 with geo atribututes and avg hpi  2020  base year is 1995   which means that HPI for uS is 100% in 1995. The avg_q  variable takes into account a mean for q1,q2,q3,q4  in the given year.

df<-readRDS("datageo2020.rds")%>%rename(Year=yr, MSA=msa.x, Annual.HPI.growth00.20=gwr00_20, State=state)



# Adding a factor  variable for border states 
df <- st_as_sf(df,  crs = 4326)
ca<-filter(df,State==" CA"|State==" CA (MSAD)")
# Interactive Map 

mapviewOptions(vector.palette=colorRampPalette(c("blue","orange","red")))

mapa<-mapview(df, map.types =  "OpenStreetMap.DE",cex="hpi20", zcol="hpi20", layer.name= "MSA House Price Index",legend = FALSE,homebutton =FALSE)
  
leafem::addMouseCoordinates(mapa)%>%setView(zoom = 3.6, -96.5716694, 39.1836082)

#htmlwidgets::saveWidget(widget = mapita, file = "C:/Users/josel/Desktop/on/I/2023/HOUSING/realstate/speech/F2map.html",  selfcontained = TRUE)
```
Source: Jose Luis Manzanares Rivera based on  House price index data from [@fhfaHousePriceIndex2022]



Empirical findings reveal a pronounced surge in housing prices, as gauged by the House Price Index (HPI), within geographically delineated metropolitan areas across the United States. Noteworthy regions exhibiting such trends encompass metropolitan statistical areas (MSAs) situated along the West Coast, the southeastern part of Florida, and the northwestern region. Over the span of the past three decades, these identified regions have witnessed substantial increase in housing values.

Among the states located on the West Coast, the State of California is particularly outstanding with areas of concern such as the Bay area where the so called Silicon Valley region represents a mayor labor market hub particularly for highly skilled workers associated with the technology sector. This geographic area holds substantial economic importance due to its concentration of technological innovation, fostering an environment  that attracts and sustains a skilled workforce with above average income which also translates into relevant tax revenue sources for the entire state. 

Furthermore within California, and right at the US southern border, the San Diego MSA, ranks among the top 10 most  expensive metropolitan areas of the entire state with a relative house price increase of 363.6 per cent in the last 25 years.

Using the above estimated pattern it is convenient to determine **which metropolitan areas registered the highest price increments since base year 1995** according to the Federal House Finance HPI? 

Figure 3 illustrates the ranking of the nation's 20 foremost metropolitan areas based on their respective positions in the House Price Index (HPI) for the year 2020. It is important to note that these areas signify the highest relative increases in home prices compared to the base year of 1995, rather than indicating the absolute highest-priced urban population centers. 

[Figure 3 Top 20 Metropolitan areas by HPI increase 2020](../speech/F3_top20.html)
```{r, include=FALSE}
#df<-readRDS("datageo2020.rds")

#msa2020<-readRDS("msa2020.rds")%>%  mutate(State=as.factor(ifelse(state==" CA"|state==" CA (MSAD)","California","Other state")), top2022=ifelse(hpi>=479.435,1,0))%>%mutate(MSA=fct_reorder(msa, hpi))%>%  rename(place_id=cbsa_code)

#df<-readRDS("datageo2020.rds")

#top20<-df%>%slice_max(hpi20, n=20)%>%  mutate(State=as.factor(ifelse(state==" CA"|state==" CA (MSAD)","California","Other state")))

#saveRDS(top20, "top20.rds")
```

```{r,echo=FALSE}
top20<-readRDS("top20.rds")%>%
rename(Place=State, State=state)  
## The plot.

top20_hpi<-ggplot(top20, aes(hpi20, reorder(msa.x, hpi20), label=State, fill=Place))+
  geom_col()+
  scale_fill_manual(values = alpha(c("dodgerblue4", "gray")),name="")+
  labs(
    x = 'House Price index 2020. (1995=100 percent)',
    y = 'Metropolitan statiscal areas (MSAs)')+
  theme(legend.position="bottom")

ggplotly(top20_hpi)%>%
  layout(legend = list(orientation = "h", x = 0, y = -.05))

#htmlwidgets::saveWidget(widget = f3top20, file = "C:/Users/josel/Desktop/on/I/2023/HOUSING/realstate/speech/F3_top20.html",  selfcontained = TRUE)

```
Source: Jose Luis Manzanares Rivera based on  House price index data from [@fhfaHousePriceIndex2022]

[Figure 3a House price index annual growth rate 1995-2022](../speech/F3a_panel_growth.html)

```{r, include=FALSE}
#floflo<-data.frame(f=c(" FL"))

#rate<-readRDS("rate.rds")%>%mutate(geo=as.factor(ifelse(state%in%border_st$border,"USMXBorder", ifelse(state%in%floflo$f,"Florida","No Border"))))
                                         
#rate$msa[rate$msa=="Fort Lauderdale-Pompano Beach-Sunrise"] <- "Fort Lauderdale"

#rate$msa[rate$msa=="West Palm Beach-Boca Raton-Boynton Beach"] <- "West Palm Beach-Boca Raton"

#rate$msa[rate$msa=="San Francisco-San Mateo-Redwood City"] <- "San Francisco-Redwood City"

#saveRDS(rate, "rate.rds")
```

```{r, echo=FALSE}

rate<-readRDS("rate.rds")

cols <- c( "#E74C3C","#154360", "#1E8449")
          
tsplot<-ggplot(rate, aes( Year, AnnualGrowth,color=geo, label = state))+
  geom_line(linewidth=.3) + 
facet_wrap(~msa, scales = "free_y")+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=2009, linetype="dotdash")+
  scale_color_manual(values = cols, name="")+
  labs(y="Annual HPI growth rate (%)")
  
ggplotly(tsplot)%>%
layout(legend = list(orientation = "h", x = 0, y = -.05))


#htmlwidgets::saveWidget(widget = panel, file = "C:/Users/josel/Desktop/on/I/2023/HOUSING/realstate/speech/F3a_panel_growth.html",  selfcontained = TRUE)
```
Source: Jose Luis Manzanares Rivera based on  House price index data from [@fhfaHousePriceIndex2022]

We now examine four discernible patterns that emerge when analyzing the top 20 metropolitan areas with the highest appreciation rates as measured by the annual growth on the HPI during the last 27 years: 

I) The importance of the US Mexico border region. $40\%$ of the top 20 (MSAs) with the highest appreciation rates are located at border states with Mexico.

II) Within the US Mexico border, the importance of California state is clear, representing $75\%$ of the border MSA with highest HPI growth. In fact San Diego-Chula Vista-Carlsbad exhibits the highest annual increase in 2022 with a $18.55\%$  
II) The real state market in Florida shows the fastest growing level of prices with sharp increases particularly during the Trump administration, with Metropolitan areas such as West Palm Beach, North Port-Sarasota-Bradenton, Naples Marco Island and Tampa featuring double digit increases with a maximum increase of $32.77\%$ the highest HPI annual growth in the nation.   

III) Traditional non high HPI areas in border states such as Texas are now starting to gain dynamism, the clear example in this region is the Austin-Roundrock-Georgetown Metropolitan area, where external economic factors such as the recent establishment of companies to support the electric vehicle industry have contribute to create speculative pressures on local real estate  markets.^[In 2020, Tesla announced its decision to build a Gigafactory in Austin, which currently  manufactures electric vehicles and attracts thousands of employment opportunities. Suppliers, service providers, and other companies in the electric vehicle industry have begun to establish operations near the Gigafactory, creating additional job opportunities and further contributing to housing demand. The presence of a major company like Tesla often attracts real estate investors looking to capitalize on the economic growth and potential appreciation in property values. Increased investor interest can lead to higher demand for housing, further impacting the housing market dynamics.] 

Although the above spatial patterns offer detailed empirical evidence to understand the incentives for population movements between metropolitan areas within states, one question that arises in the context of economic determinants of house prices is:  What role does available economic policy instruments have played to shape the US real state markets in the last two decades? 

### Interest rates as a key macroeconomic policy instrument shaping real estate decisions.

Certainly this period has witnessed at least two of the most remarkable and complex scenarios in economic recent history that deserve to be explained given its relevance for US society in general and households paying a mortgage in particular: **I) the Great Recession**, the economic downturn that occurred between December 2007 and June 2009. II) **The COVID19 health emergency** declared in January 2020.

In accordance with conventional economic theory, a fundamental factor influencing the overall fluctuations in the aggregate price level is the cost of borrowing, formally known as the interest rate. Interest rates are a core instrument of monetary policy that play a pivotal role in shaping economic dynamics and has significant implications for various sectors of the economy, including real estate markets. 

Therefore, understanding the evolution in time of interest rates is crucial for comprehending not only the aggregate price level fluctuations, but also its impacts on particular components, among which housing prices bear a specially important role for households. 

We now turn to the analysis of this important macroeconomic determinant and begin by presenting the trajectory overtime for the Federal Funds effective rate. 
This rate serves as a benchmark or reference point for other short-term interest rates, exerting a considerable influence on the overall cost of borrowing and lending in the economy.

The importance of the **Federal Funds effective rate (FFER)** is particularly pronounced in relation to the housing sector and real estate markets. Firstly, it directly affects the cost of mortgage borrowing for home buyers. Changes in the Federal Funds rate can lead to adjustments in mortgage interest rates, impacting affordability and demand for housing. Lower rates tend to stimulate borrowing and housing activity, while higher rates may dampen demand. This inverse relation is paramount to explain supply and demand side factors that have been taking place in the US housing market as we will soon discover. 

Figure 4, presents the evolution of the FFER in the period from  to July 2000 to May 2023. 

[Figure 4 Monetary policy: The federal Funds Effective rate evolution July 2000  May 2023](../speech/F4_FFER.html)
```{r, echo = FALSE}

# FFER plot 

ts_FFER<-readRDS("ts_FFER.rds")

dygraph(ts_FFER)%>% 
dyRangeSelector()%>%
dyHighlight(highlightCircleSize = 3, 
highlightSeriesBackgroundAlpha = 0.2
)%>%
dySeries("FEDFUNDS", color = "#D35400",fillGraph = TRUE,label ="Federal Funds Effective Rate")%>%
dyAxis("y", label = "Percent")%>%
dyLegend(width = 300)%>%
dyEvent("2008-07-01", "QE Subprime mortgage market collapse", labelLoc = "top", color = "black")%>%
dyEvent("2020-02-01", "NBER Economic recession: QE -Ultra Low interest rates-", labelLoc = "top", color = "blue")%>%
  dyEvent("2022-02-01", "Monetary policy change ending quantitative easing", labelLoc = "top", color = "red")%>%
dyOptions(axisLineWidth = 1.5, fillGraph = TRUE, drawGrid = FALSE)

#htmlwidgets::saveWidget(widget = ts_FFERp, file = "C:/Users/josel/Desktop/on/I/2023/HOUSING/realstate/speech/F4_FFER.html",  selfcontained = TRUE)

# Source: https://fred.stlouisfed.org/series/FEDFUNDS
```

Source: José Luis Manzanares Rivera based on data from Federal Reserve. [@boardofgovernorsofthefederalreservesystemFederalFundsEffective2023]

The representation above covers 23 years of Federal Funds effective rate fluctuations. Over the span of this period, monetary policy has experienced important changes with implications for the housing markets. 

The first, marked here with a benchmark date in reference to the **sub-prime mortgage market collapse** ^[Sub-prime mortgage is defined here as higher-risk loans granted to borrowers with lower creditworthiness], An episode in the recent economic history of the United States that embodies one of the primary determinants shaping the so called  **"Great Recession."**

Prior to this period, the Federal Reserve´s monetary policy had set the FFER at $5.26\%$ which its the highest interest level that US society has experienced between July 2007 and the moment of the writing of this work (May 2023).

Following the sub-prime mortgage market collapse, which set the stage for the beginning of the global financial crisis, the US central bank, decided to implement measures via the its key monetary policy instruments, to stimulate the economy. 

Considering the substantial scale and breadth of the economic contraction, it was anticipated that the path to recovery would entail a protracted ascent. Consequently, the Federal Funds Effective Rate (FFER) underwent a deliberate reduction, plummeting to historically low levels, reaching a floor of $0.07\%$ by January 2014.

How does the housing market reacted to this unprecedented period of ultra low interest rates? 

Before moving on to answer that question, let´s study a second relevant shift in monetary policy. According to empirical evidence shown above, the monetary policy stimulus period to promote economic recovery related to the **Great Recession**, lasted 7 years, (Jan 2009-Dec 2015).

However, when quantitative easing^[For the purposes of the present investigation we use the term Quantitative easing to refer to a monetary policy tool employed by central banks to stimulate the economy and promote lending and investment. QE involves the central bank purchasing government bonds or other financial assets from commercial banks and other financial institutions. By doing so, the central bank injects new money into the financial system, increasing the money supply and lowering interest rates. The aim of quantitative easing is to encourage borrowing and spending, thereby boosting economic activity] seemed to be ending; on January 31, 2020, Department of Health and Human Services (HHS) under the Public Health Service Act, declared a public COVID-19 health emergency. This declaration allowed the HHS to activate emergency response mechanisms, mobilize resources and coordinate efforts to contain and mitigate the spread of the public health threat within the country. 

Among those measures, as we now know, there were significant mobility restrictions that infringed an unprecedented toll on economic activity with emphasis in the labor market. Triggering a relevant economic slowdown, that required once more, a decisive intervention by the central bank authorities to prevent a deeper economic crisis and to stimulate a recovery.

In this unprecedented complex global economic setting, the Federal Reserve of the United States decided to move the FFER from a $2.4\%$ in July 2019 to an ultra low  $0.05\%$ in April 2020, (the lowest on record in this century) sending a clear signal to the markets in an effort to stimulate spending and investment aiming to correct the **sharp decline in consumer spending** associated with the labor market disruptions caused by the overall restrictive measures put in place during the global health emergency. 

This dovish monetary policy strategy was extended for almost two years and only started to be normalized by April 2022. 

### Capturing housing market social sentiment embedded in google search engine data. 

To capture the broader social dimension and the effects of this economic determinants on the housing markets, we proposed to analyze Google search data. A social sentiment data driven approach by which we compare the relative search frequency overtime for specific terms related to the housing market. This approach has been gaining increasing attention and it offers a complementary perspective.

The following analysis contains the Google score trend for terms:  "affordable home", "foreclosure" and "eviction". This terms are  plotted against particular macroeconomic policy threshold dates and external shocks events. Results are shown by figure 5. Specifically with this terms selection the segment of home owners and renters are incorporated into the analysis.

[Figure 5 California Google trends score 2004-2023. Selected terms](../speech/F5_google_a.html)[Fig5b](../speech/F5_google_b.html)
```{r, echo=FALSE}
# Plots  google trends.
ts_foreclosure<-readRDS("ts_foreclosure.rds")
ts_trends<-readRDS("ts_trends.rds")

dygraph(ts_trends,  group= "a", main = "Affordable home")%>% 
dyRangeSelector()%>%
dyHighlight(highlightCircleSize = 3, 
highlightSeriesBackgroundAlpha = 0.2,
hideOnMouseOut = FALSE)%>%
dySeries("score", label ="Term: Affordable home", fillGraph = TRUE)%>%
dyAxis("y", label = "California. Google trends score")%>%
dyLegend(width = 300)%>%
dyEvent("2008-07-01", "Subprime mortgage market collpse 2008-07-01", labelLoc = "top", color = "red")
```


```{r, echo=FALSE}

dygraph(ts_foreclosure, group= "a", main = "Terms: Eviction, Foreclosure")%>% dyRangeSelector()%>%
dyHighlight(highlightCircleSize = 3, 
highlightSeriesBackgroundAlpha = 0.2,
hideOnMouseOut = FALSE)%>%
dySeries("foreclosure", color = "#E74C3C",fillGraph = TRUE, label = "Foreclosure" )%>%
dyAxis("y", label = "California Google trends score")%>%
dySeries("eviction", color="#2874A6",label = "Evictions", axis = 'y2')%>%
dyAxis("y2", label = "Score")%>%
dyLegend(width = 300)%>%
dyOptions(drawGrid = FALSE,  strokeWidth = c(1, 3))%>%
dyEvent("2020-02-01", "January 31, 2020 COVID-19 Health emergency", labelLoc = "top", color = "gray")

#htmltools::browsable(htmltools::tagList(ggsearch))


#htmlwidgets::saveWidget(widget = GG5b, file = "C:/Users/josel/Desktop/on/I/2023/HOUSING/realstate/speech/F5_google_b.html",  selfcontained = TRUE)

```
Source: José Luis Manzanares Rivera based on data from [@googleGoogleTrendss2023]

We can clearly note the effect of the *sub-prime mortgage market* collapse in the population sentiment reflected as a higher volume of search for terms such as "affordable home" which indicate a tight real state market during the second quarter of **2009**. 

In addition, during this period we found the highest scores over the last two decades for the term **foreclosure**^[a legal process in which a lender attempts to recover the balance of a loan from a borrower who has stopped making payments to the lender by forcing the sale of the asset used as the collateral for the loan.], interestingly enough, when we analyze "eviction" a term that reflects housing market stress associated to the **renters segment**, we observe a clear indication of the labor market tightening caused by the **health emergency restrictions** after January **2020**.

### Housing market reactions and potential investment opportunities.  

We may now turn to study the effects of this macroeconomic determinants and external shocks to the economy into the housing markets and its relation to current internal migration patterns with a focus in specific regions of the country, such as the US-Mexico border states and metropolitan areas. 

Figure 6, below examines time series from the Federal Reserve financial accounts data to show the evolution of mortgage debt outstanding in relation to the housing stock market value, an important feature that offers a unique perspective to measure home equity growth a key indicator that reflects supply and demand dynamics for the housing market as a result of fluctuations registered on primary macroeconomic environment instruments such as the federal funds effective rates. 

Although this approach provides an nation wide perspective it captures a base trend whose implications then can be examined using a detailed geographic scale. 


[Figure 6 Real estate at market value and rising equity 1980-2023](../speech/F6a_equity.html), [See F6b](../speech/F6b_equity.html)
```{r, echo=FALSE}
# Plots.
## Rising equity 
## loading data 

ts_b101<-readRDS("ts_b101.rds")
b101_e<-readRDS("b101_e.rds")

## Dygraph plot
dygraph(ts_b101,  group= "a", main = "Real estate at market value")%>% 
dyRangeSelector()%>%
dyHighlight(highlightCircleSize = 3, 
highlightSeriesBackgroundAlpha = 0.2,
hideOnMouseOut = FALSE)%>%
dySeries("mortgage", label ="Mortgage Debt Outstanding", fillGraph = TRUE, color = "red")%>%
dySeries("value", label ="Real estate at market value", fillGraph = TRUE, color = "green")%>%
dyAxis("y", label = "(Trillion  USD, not)")%>%
dyLegend(width = 300)%>%
dyOptions(drawGrid = FALSE)%>% 
dyEvent("2008-07-01", "Subprime mortgage market collpse", labelLoc = "bottom", color = "purple")%>%
dyEvent("2020-04-01", "Quantitative Easing-Ultra Low interes rates-", labelLoc = "top", color = "blue")
```


```{r, echo=FALSE}

dygraph(b101_e, group= "a", main = "Raising Equity")%>% dyRangeSelector()%>%
dyHighlight(highlightCircleSize = 3, 
highlightSeriesBackgroundAlpha = 0.2,
hideOnMouseOut = FALSE)%>%
dySeries("equity",fillGraph = TRUE, color = "#34495E", label = "Home Equity" )%>%
dyAxis("y", label = "House stock Equity (Trillion)")%>%
dySeries("Percent", label = "%" , color="#641E16",axis = 'y2', strokePattern = "dashed")%>%
dyAxis("y2", label = "Share of total housing stock value ")%>%
dyLegend(width = 300)%>%
dyOptions(drawGrid = FALSE)

# htmltools::browsable(htmltools::tagList(dy_graph_equity))

#htmlwidgets::saveWidget(widget = F6b, file = "C:/Users/josel/Desktop/on/I/2023/HOUSING/realstate/speech/F6b_equity.html",  selfcontained = TRUE)

```
Source: José Luis Manzanares Rivera based on data from [@federalreseveFinancialAccountsUnited2023]


For existing home owners, home equity has more than double during the last decade (from 2006Q4 to 2022Q4 with a 213% growth).

**Why there was such growth in home equity in the nation during the last decade?** 

As we have seen, monetary policy is partially responsible for this trend, given a sustained period of quantitative easing. (starting from December 2008 with a Federal reserve effective rate (FFFER) = $0.16\%$ down from $5.26\%$ in July 2007 -prior to sub prime mortgage market collapse- Followed by a second ultra low FFER period that was implemented to cope with a deceleration of the economy in the presence of the global public health emergency triggered  by the COVID-19 restrictions, starting at 2020Q1 with FFER = $0.05\%$ down from FFER=$2.40 \%$ in june 2019. 

**Who benefited from this historical monetary policy scenario  characterized by ultra low interest rate?** 

Specially people who bought homes in attracting real state markets areas with dynamic internal migration patterns, who manage to **profit** from this  **historic ultra low interest rate** period, by entering the market and securing a Fixed-rate mortgage just after the sub prime mortgage collapse, that is **between December 2008 and November 2015.**  

This movers took advantage of the economic stimulus provided by the macroeconomic environment created with a monetary policy oriented for **quantitative easing**, a strategy  designed to lower the price of money in an effort to boost consumption and investment, among other things. For example, **home equity** for existing housing stock in the US in 2012Q1 was **$10.25$T** and it **grew to $33.78$T in 10 years**,  a **3X order of magnitude increase!**

In addition, detailed mortgage records kept by government sponsored enterprises such as Freddie Mac and Fannie Mae, allow to distinguish the type of loan granted to actual current mortgage clients, this data is important to show real estate investment trends across Metropolitan areas. 

Nationwide **87.3%** of **Freddie Mac clients** are paying a loan for a house that is a **primary residence.** Almost **4%** of  Freddie Mac home buyers are buying a **second home**.  And **8.9%** are paying a home loan classified as **investment.** 

If we think of **second home loans** as a proxy for social status, say, better off household apply for this type of loan, then the  families in the states of  **Virginia, Vermont, Delaware  Maine and Florida** are the places were this type of families mostly live. 

Figure 7  below ranks metropolitan areas (MSAs) by the number of loans classified as investment by Freddie Mac single family loan data for the first quarter of 2022 [@freddiemachomeSingleFamilyLoanLevel2023]. 

[Figure 7. Top 20 Metropolitan Areas. Investment Home loans 2022-Q1](../speech/F7_invest.html)

```{r, echo=FALSE, fig.height=6, fig.width=7}

#top20_metros_inv<-readRDS("top20metros_invest.rds")%>%  mutate(USMXBorder=as.factor(ifelse(state%in%border_st$border,"USMXBorder","No Border")))%>% slice_max(t, n=20)

#saveRDS(top20_metros_inv, "top20_metros_inv.rds")

top20_metros_inv<-readRDS("top20_metros_inv.rds")%>%
  rename(Investment.Loans=t, MetropolitanArea=GEO_Name)%>%
  mutate(MSA=fct_reorder(MetropolitanArea, Investment.Loans))

### the plot 

inv_plot<-ggplot(top20_metros_inv, aes(Investment.Loans, MSA, fill = USMXBorder)) +
  geom_col() +
  scale_fill_manual(values = c("#AEB6BF", "#C0392B"), name="") +
  labs(      x = 'Total investment loans',
       y = 'Metropolitan Statistical area')+
    theme(
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank()
    )
## to place the lables inside the bars 
geom_label(
    aes(label = perc), 
    hjust = 1, nudge_x = -.5,
    size = 4, fontface = "bold", family = "Fira Sans",
    ## turn into white box without outline
    fill = "white", label.size = 0
  ) 


inv_plot <- inv_plot +
  geom_text(
    aes(label = MSA),
    position = position_stack(vjust = 0.5), # Adjust the position of labels
    size = 3, # Set the size of labels
    color = "white" # Set the color of labels
  )

## To display as ggplot

ggplotly(inv_plot)%>%
  layout(legend = list(orientation = "h", x = 0, y = -.05))

#htmlwidgets::saveWidget(widget = fig7, #the plotly object 
                        #file = "C:/Users/josel/Desktop/on/I/2023/HOUSING/realstate/speech/F7_invest.html", 
                        #the path & file name selfcontained = TRUE 
  #creates a single html file )
```

Source: José Luis Manzanares Rivera based on data from Freddie Mac Single-Family Loan-Level 2022Q1 [@freddiemachomeSingleFamilyLoanLevel2023]

The information above for loan category: investment,  indicates which metropolitan areas are conceived as dynamic real estate centers across the nation.  It is found that The **Phoenix-Mesa-Scottsdale Arizona MSA**, shows the highest investment property type of loans in the US for data on the first quarter of 2022.  

Furthermore, data analysis at the state scale indicates that **California** is the state with the highest percentage of home loans classified as investment ($11.88\%$ a proportion statistically different from the US median $7.9\%$). Given the raising trend for home prices in the state, this pattern suggest the presence of speculative pressures, that may limit the supply of affordable homes in this particular area of the country. 

Lets now analyze from a geographic perspective, how home prices have appreciated during this economic policy changes.

Figure 8 below shows a national perspective for the distribution of home price index developed by Freddie Mac in a monthly series which takes as base year 2000. The figure shows year 2006 figures in order to capture a moment in time prior to the implementation of a dovish monetary policy and then it allows comparison to the current year 2023.


[Figure 8 HPI by state 2006](../speech/F6_hpi.html)

```{r, echo=FALSE, warning=FALSE, message=FALSE}

#library(tigris)

#us_geo <- tigris::states(cb = TRUE, resolution = '20m')%>%rename(state=STUSPS)
#master_freddie_2006<-readRDS("master_freddie_2006.rds")
#Index<-inner_join(us_geo, master_freddie_2006, by ="state")%>%select(HPI, state, NAME)%>%rename(HPI_2006=HPI)

#saveRDS(Index,"Index.rds")

library(wesanderson)

Level<-readRDS("Index.rds")%>%
  rename(HPI2006=HPI_2006)

hpi06_map <- mapview(Level, zcol = "HPI2006", col.regions = wes_palette(n = 5, name = "Zissou1"), alpha.regions = 2)

leafem::addMouseCoordinates(hpi06_map)%>%setView(zoom = 3.6, -96.5716694, 39.1836082)

# htmlwidgets::saveWidget(  widget = map06, #the plotly objectfile = "C:/Users/josel/Desktop/on/I/2023/HOUSING/realstate/speech/F6_hpi.html", #the path & file nameselfcontained = TRUE #creates a single html file)



```
Source: José Luis Manzanares Rivera based on data from Freddie Mac HPI base year 2000 [@freddiemacFreddieMacHouse2023].


Evidence suggest that before the great recession and prior to the implementation of quantitative easing monetary policies, the  US housing market, featured California and Florida as the top most expensive regions of the country. Together with a well defined region along the north eastern cost with New York Virginia and Maryland comprised a traditional high cost set of states. Virtually the central regions of the country were not showing sings of significant house price increases as of 2006.

As we have shown, the implementation of historic measures to stabilize the economic environment lead to very special and not usual conditions that served as changing forces that have impacted the real state market landscape. These factors created both, market incentives for investment opportunities as well as affordability issues for some segments of the US population, that in the face of being price-out are reinforcing current internal migration patterns.


The following map shows the "after" scenario featuring HPI levels for 2023. 



[Figure 8b HPI by state 2023](../speech/F7_hpi23.html)
```{r,echo=FALSE, warning=FALSE, message=FALSE}

library(wesanderson)


#master_freddie_2023<-readRDS("master_freddie_2023.rds")

#Index23<-inner_join(us_geo, master_freddie_2023, by ="state")%>%select(values, state, NAME)%>%rename(HPI_2023=values)

#saveRDS(Index23,"Index23.rds")

Levels<-readRDS("Index23.rds")

hpi23_map <- mapview(Levels, zcol = "HPI_2023", col.regions = wes_palette(n = 5, name = "Zissou1"), alpha.regions = 2)

leafem::addMouseCoordinates(hpi23_map)%>%setView(zoom = 3.6, -96.5716694, 39.1836082)

#htmlwidgets::saveWidget(  widget = map23, #the plotly object
                        #  file = "C:/Users/josel/Desktop/on/I/2023/HOUSING/realstate/speech/F7_hpi23.html", 
#the path & file name
#selfcontained = TRUE #creates a single html file)

```
Source: José Luis Manzanares Rivera based on data from Freddie Mac HPI base year 2000 [@freddiemacFreddieMacHouse2023].

Following the implementation of macroeconomic policy with an extended period of favorable interest rates, empirical evidence suggest that the housing market have been diversifying out of the **traditional high cost regions** of the country. 

In this regard we identify at least two important geographic patterns  I) A movement of high housing prices from the pacific west cost towards the northeastern states closer to Canadian border.  Also, considering the south, two Mexican border states are showing a rapidly increasing real state market: Arizona and Texas II) Traditionally expensive states in the north east, have been experiencing a relative cooling off in favor of emerging regions. 


There are two particular cases that require a closer examination:


**The case of Arizona** The significant House Price Index (HPI) increase observed in Arizona, particularly in the Phoenix metropolitan area, can be attributed to various real estate elements and economic features. Some factors that may explain this trend include: population growth and economic development, both factors impacting prices via a growing housing demand. 

Population Growth: Phoenix has experienced substantial population growth over the last two decades. The increasing population creates a higher demand for housing, leading to upward pressure on home prices, as shown  by  figure 9 below.


Economic Development: Phoenix has been a hub for economic development, attracting industries such as technology, finance, healthcare, and manufacturing. The presence of major companies, business-friendly policies related to tax regulations, and a growing job market have contributed to the region's economic growth. This, in turn, stimulates demand for housing which exhibits a direct positive relation to price increases as we will now analyze using population, per capita income and house prices at a metropolitan area scale for selected US-Mexico Border (MSAs).


**The case of Idaho.** 

Migration patterns: According to the U.S. Census Bureau's population estimates and migration data, Idaho has experienced consistent net positive domestic migration (inflow of people from other states, particularly from high-cost areas like California and the Pacific Northwest) over the past two decades. 

Within Idaho, specific Metropolitan Statistical Areas (MSAs) have experienced substantial population flows from other out-of-state MSAs. For example, the **Boise metropolitan area**, which includes Ada County, has been a major recipient of in-migration. It has attracted individuals and families from various out-of-state MSAs, including mainly areas in California, Washington and Oregon.  Chapter 2 analyses internal migration flows in detail.


**Figure 8c HPI by state evolution over time 1975-2022**
```{r, include=FALSE}

library(usmap)
library(PNWColors)
library(ggeasy)


#master_freddie<-read.csv("fmhpi_master_file.csv")%>%filter(GEO_Type=="State", Year!="2023", GEO_Name!="HI", GEO_Name!= "DC",GEO_Name!="PR",Year>="2000")%>%group_by( Year,GEO_Name )%>% summarize(index=median(Index_SA))%>%   mutate(log=log(index), Year=as.numeric(Year))%>%   rename(state=GEO_Name)

#pal <- pnw_palette("Bay", n=100, type="continuous")

#plot <- plot_usmap(data = master_freddie, values = "index", labels=FALSE) + scale_fill_gradientn(colours = pal, name = "HPI")+easy_move_legend(to = c("right")) + theme(panel.background = element_rect(colour = "black"))

#transition <- plot +labs(title = "HPI 2000-2022 {as.integer(frame_time)}") +transition_time(Year)+ ease_aes('linear')

#transition

#anim_save("usmap.gif", transition, width = 630, height = 500)
```


```{r, echo=FALSE, warning=FALSE, message=FALSE}

library(magick)
usmapmig <- image_read("usmap.gif")
usmapmig
```

```{r,include=FALSE}

## Representing a map to show HPI (apretiation ) HPI 1975-2022  Using data from Freddie Mac. 

# Base month  is The FMHPI is calculated so that the index value for December 2000 equals 100.

# Read the .gif file
#image <- image_read("HPI_apreciation_map.gif")
#image

```

Source: José Luis Manzanares Rivera based on data from Freddie Mac HPI base year 2000 [@freddiemacFreddieMacHouse2023].

Finally figure 9 below represents the evolution of house prices for US Mexico border Metropolitan statistical areas. 

**Figure 9 US-Mexico border (MSAs). Housing prices evolution**


```{r, include=FALSE}

## This is the data wrangling for plot HPI for border only MSA over  1975 - 2023. Base year  2000

library(viridis)
library(hrbrthemes)

#border<-data.frame(GEO_Name=c("Yuma AZ", "Brownsville-Harlingen TX","El Centro CA","El Paso TX", "Laredo TX", "San Diego-Carlsbad CA","Sierra Vista-Douglas AZ", "McAllen-Edinburg-Mission TX"))

#master_freddie<-read.csv("fmhpi_master_file.csv")%>%inner_join(border)%>%group_by( Year,GEO_Name )%>% summarize(index=median(Index_SA))


#cols <- c( "black","#154360", "#1E8449", "yellow", "purple","red", "green", "blue")


#pplot <- master_freddie %>%ggplot(aes(x = Year, y = index, color = GEO_Name)) +geom_line() +geom_point() +geom_vline(xintercept =2007, linetype="dashed", color="black", size=.5)+geom_hline(yintercept =100,  color="dodgerblue4", size=.5, linetype="dashed")+scale_color_manual(values = cols, name = "") +  theme(legend.position = c(0.35, 0.7), panel.background = element_rect(fill = "white"))+labs(y = "HPI 2000=100") + transition_reveal(Year)+ scale_x_continuous(breaks = seq(min(master_freddie$Year), max(master_freddie$Year), by = 5))+ scale_y_continuous(n.breaks=8)+ annotate("text", x=2008, y=250, size=3.5,label="Subprime mortgage market collapse",angle = 90) + theme(legend.text = element_text(size = 14), axis.text = element_text(size = 13)) 

#pplot
#anim_save("hpi_border1975-2023.gif", pplot, width = 680, height = 500) 

```

```{r, echo= FALSE, message=FALSE, Warnig=FALSE}
## Making the animated line plot
library(magick)
evolution <- image_read("hpi_border1975-2023.gif")
evolution
```
Source: José Luis Manzanares Rivera based on data from Freddie Mac HPI base year 2000 [@freddiemacFreddieMacHouse2023] 

The clear upward trend for San Diego-Chula Vista-Carlsbad area situated right across the Border from the major Mexican border city Tijuana, certainly represents a relevant case study considering affordability restrictions and opportunities that appear given this close geographic proximity. 

Considering evidence on real state market prices in Californian (MSAs), labor market conditions as well as supply and demand exogenous shocks, the analysis suggest that search for affordability  may be one of the reasons why some people have decided to relocate out of state or even to make the move across the border, this is however an hypothesis that is subject to further empirical validation. 

## Discussion.

## Conclusions.
